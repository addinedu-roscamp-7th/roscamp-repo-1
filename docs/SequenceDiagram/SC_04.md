@startuml
title Pickee 복귀 및 충전 프로세스

participant "Shopee\nMain Service" as Shopee
participant "Pickee\nMain Controller" as PickeeCtrl
participant "Pickee\nMobile Controller" as MobileCtrl

activate PickeeCtrl

PickeeCtrl -> Shopee: [ROS2 Topic] 장바구니 교체 완료\n(/pickee/cart_handover_complete)
activate Shopee

Shopee -> Shopee: 복귀 지시\n여부 판단

Shopee -> PickeeCtrl: [ROS2 Service] 복귀 명령
(/pickee/workflow/return_to_base)

PickeeCtrl --> Shopee: [ROS2 Service] 복귀 명령 응답
(/pickee/workflow/return_to_base)

deactivate Shopee

PickeeCtrl -> PickeeCtrl: Global Path\n계획

PickeeCtrl -> PickeeCtrl: 상태 변경\n(대기장소이동->충전)

PickeeCtrl -> MobileCtrl: [ROS2 Service] 목적지 이동 명령\n(/pickee/mobile/move_to_location)
activate MobileCtrl

MobileCtrl --> PickeeCtrl: [ROS2 Service] 목적지 이동 명령 응답\n(/pickee/mobile/move_to_location)

MobileCtrl -> MobileCtrl: 경로 주행

MobileCtrl -> PickeeCtrl: [ROS2 Topic] 도착 알림\n(/pickee/mobile/arrival)
deactivate MobileCtrl

PickeeCtrl -> Shopee: [ROS2 Topic] 도착 보고\n(/pickee/arrival_notice)

group 충전 프로세스
    opt 배터리 < 30%
        PickeeCtrl -> PickeeCtrl: 충전
        
        PickeeCtrl -> PickeeCtrl: 배터리 체크
    end
    
    PickeeCtrl -> PickeeCtrl: 상태변경\n(충전->작업대기)
end

deactivate PickeeCtrl

@enduml