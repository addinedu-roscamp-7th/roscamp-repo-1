@startuml SC_02_2_1
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as vision
participant "Pickee\nMobile Controller" as pickee_mobile

loop 장애물 감지 및 회피
    vision -> vision: 장애물 인식
    activate vision
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> vision: 장애물 분류\n(타입, 위치, 속도, 거리)
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> pickee_main: [ROS2 Topic] 장애물 감지 알림\n(/pickee/vision/obstacle_detected)
    activate pickee_main
    
    pickee_main -> pickee_main: 회피 가능성 판단
    activate pickee_main #DarkSalmon
    deactivate pickee_main
    
    alt 작은 장애물 (Local 회피 가능)
        pickee_main -> pickee_mobile: [ROS2 Service] Local Path 수정 명령
        activate pickee_mobile
        
        pickee_mobile -> pickee_mobile: Local Path 수정
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 수정 Path 주행
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        deactivate pickee_mobile
        
    else 큰 장애물 (Global 재계획 필요)
        pickee_main -> pickee_main: Global Path 재계획
        activate pickee_main #DarkSalmon
        deactivate pickee_main
        
        pickee_main -> pickee_mobile: [ROS2 Service] Global Path 업데이트\n(/pickee/mobile/update_global_path)
        activate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 새 Global Path 추종
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        pickee_mobile --> pickee_main: [ROS2 Service] Global Path 업데이트 응답\n(/pickee/mobile/update_global_path)
        deactivate pickee_mobile
    end
    
    deactivate pickee_main
    deactivate vision
end

@enduml