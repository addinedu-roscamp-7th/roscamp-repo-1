@startuml SC_02_2_1
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as vision
participant "Pickee\nMobile Controller" as pickee_mobile

loop 장애물 감지 및 회피
    vision -> vision: 장애물 인식
    activate vision
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> vision: 장애물 분류\n(타입, 위치, 속도, 거리)
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> pickee_main: [ROS2 Topic] 장애물 감지 알림\n(/pickee/vision/obstacle_detected)
    activate pickee_main
    
    pickee_main -> pickee_main: 속도 모드 결정\n(장애물 유무 기반)
    activate pickee_main #DarkSalmon
    deactivate pickee_main
    
    pickee_main -> pickee_mobile: [ROS2 Topic] 속도 제어 및 장애물 정보 전달\n(/pickee/mobile/speed_control)
    activate pickee_mobile
    
    pickee_mobile -> pickee_mobile: 장애물 분석 및 위험도 평가
    activate pickee_mobile #DarkSalmon
    deactivate pickee_mobile
    
    alt 작은/동적 장애물
        pickee_mobile -> pickee_mobile: Local Path만으로 회피 처리
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
    else 큰/정적 장애물
        pickee_mobile -> pickee_mobile: Global Path 동적 수정
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 수정된 Global Path 기반 주행
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
    else 위험 상황
        pickee_mobile -> pickee_mobile: 긴급 정지 또는 감속
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
    end
    
    deactivate pickee_mobile
    
    deactivate pickee_main
    deactivate vision
end

@enduml