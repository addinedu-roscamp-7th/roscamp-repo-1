@startuml
title SC_03_2 장바구니 교체 확인 및 완료 프로세스

participant "Shopee\nMain Service" as main
participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as pickee_vision
participant "Pickee\nArm Controller" as pickee_arm

activate pickee_main

pickee_main -> pickee_arm: [ROS2 Service] 자세 변경 요청\n(/pickee/arm/move_to_pose, pose_type=cart_view)
activate pickee_arm

pickee_arm -> pickee_arm: 장바구니 확인 자세

pickee_arm --> pickee_main: [ROS2 Service] 자세 변경 응답\n(/pickee/arm/move_to_pose)

pickee_arm -> pickee_main: [ROS2 Topic] 자세 변경 상태\n(/pickee/arm/pose_status)
deactivate pickee_arm

loop 장바구니 유무 확인
    pickee_main -> pickee_vision: [ROS2 Service] 장바구니 존재 확인 요청\n(/pickee/vision/check_cart_presence)
    activate pickee_vision

    pickee_vision -> pickee_vision: 장바구니 유무\n확인

    pickee_vision --> pickee_main: [ROS2 Service] 장바구니 존재 확인 응답\n(/pickee/vision/check_cart_presence)
    deactivate pickee_vision
end

pickee_main -> pickee_main: Pickee 상태 변경\n(WAITING_HANDOVER->MOVING_TO_STANDBY)

pickee_main -> main: [ROS2 Topic] 장바구니 교체 완료\n(/pickee/cart_handover_complete)


deactivate pickee_main

@enduml