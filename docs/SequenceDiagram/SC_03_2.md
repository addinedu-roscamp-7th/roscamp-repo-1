@startuml
title SC_03_2 장바구니 교체 확인 및 완료 프로세스

participant "Shopee\nMain Service" as Shopee
participant "Pickee\nMain Controller" as MainCtrl
participant "Pickee\nVision AI Service" as Vision
participant "Pickee\nAr m Controller" as ArmCtrl

activate MainCtrl

MainCtrl -> ArmCtrl: [ROS2 Service] 자세 변경 요청\n(/pickee/arm/move_to_pose, pose_type=cart_view)
activate ArmCtrl

ArmCtrl -> ArmCtrl: 장바구니 확인 자세

ArmCtrl --> MainCtrl: [ROS2 Service] 자세 변경 응답\n(/pickee/arm/move_to_pose)

ArmCtrl -> MainCtrl: [ROS2 Topic] 자세 변경 상태\n(/pickee/arm/pose_status)
deactivate ArmCtrl

loop 장바구니 유무 확인
    MainCtrl -> Vision: [ROS2 Service] 장바구니 존재 확인 요청\n(/pickee/vision/check_cart_presence)
    activate Vision
    
    Vision -> Vision: 장바구니 유무\n확인
    
    Vision --> MainCtrl: [ROS2 Service] 장바구니 존재 확인 응답\n(/pickee/vision/check_cart_presence)
    deactivate Vision
end

MainCtrl -> MainCtrl: Pickee 상태변경\n(장바구니 전달 -> 대기장소이동)

MainCtrl -> Shopee: [ROS2 Topic] 장바구니 교체 완료\n(/pickee/cart_handover_complete)

deactivate MainCtrl

@enduml