@startuml SC_02_1
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Shopee App" as app
participant "Shopee\nMain Service" as main
participant "DB Manager" as db_manager
participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nMobile Controller" as pickee_mobile

main -> pickee_main: [ROS2 Service] 섹션 이동 명령\n(/pickee/workflow/move_to_section)
activate pickee_main

pickee_main -> pickee_main: Pickee 상태 변경\n(CHARGING_AVAILABLE->MOVING_TO_SHELF)
activate pickee_main #DarkSalmon
deactivate pickee_main

pickee_main --> main: [ROS2 Service] 섹션 이동 명령 응답\n(/pickee/workflow/move_to_section)

pickee_main -> main: [ROS2 Service] 좌표 요청\n(/main/get_location_pose)
activate main
main -> db_manager: 좌표 요청
activate db_manager
db_manager --> main: 좌표 반환
deactivate db_manager
main --> pickee_main: [ROS2 Service] 좌표 요청 응답\n(/main/get_location_pose)
deactivate main

pickee_main -> pickee_mobile: [ROS2 Service] 목적지 이동 명령\n(/pickee/mobile/move_to_location)\n+ 목적지 좌표만 전달
activate pickee_mobile

pickee_mobile -> pickee_mobile: Global Path 자동 생성\n(A* 알고리즘 등)
activate pickee_mobile #DarkSalmon
deactivate pickee_mobile

pickee_mobile --> pickee_main: [ROS2 Service] 목적지 이동 명령 응답\n(/pickee/mobile/move_to_location)

pickee_main -> main: [ROS2 Topic] 이동 시작 알림\n(/pickee/moving_status)
activate main

main -> app: [TCP] 로봇 이동 알림\n(robot_moving_notification)
activate app

app -> app: 이동 시작\n알림
activate app #DarkSalmon
deactivate app

pickee_mobile -> pickee_mobile: Local Path Planning\n(실시간 LiDAR 장애물 회피)
activate pickee_mobile #DarkSalmon
deactivate pickee_mobile

pickee_mobile -> pickee_mobile: 경로 추종
activate pickee_mobile #DarkSalmon
deactivate pickee_mobile

pickee_mobile -> pickee_mobile: 목적지 도착 확인
activate pickee_mobile #DarkSalmon
deactivate pickee_mobile

pickee_mobile -> pickee_main: [ROS2 Topic] 도착 알림\n(/pickee/mobile/arrival)
deactivate pickee_mobile

pickee_main -> main: [ROS2 Topic] 도착 보고\n(/pickee/arrival_notice)
deactivate pickee_main

main -> app: [TCP] 로봇 도착 알림\n(robot_arrived_notification)
deactivate main

app -> app: 매대 도착 알림
activate app #DarkSalmon
deactivate app

deactivate app

@enduml