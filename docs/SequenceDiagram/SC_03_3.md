@startuml
title Packee 작업 가능 확인 및 장바구니 인식 프로세스

participant "Shopee\nMain Service" as main
participant "DB Manager" as db
participant "Pickee\nMain Controller" as pickee
participant "Packee\nMain Controller" as packee_main
participant "Packee\nVision AI Service" as packee_vision
participant "Packee\nArm Controller" as packee_arm

activate main

pickee -> main: [ROS2 Topic] 장바구니 교체 완료\n(/pickee/cart_handover_complete)

main -> packee_main: [ROS2 Service] 작업 가능 확인 요청\n(/packee/packing/check_availability)
activate packee_main

packee_main --> main: [ROS2 Service] 작업 가능 확인 요청 응답\n(/packee/packing/check_availability)

packee_main -> packee_main: Packee 상태 변경\n(STANDBY->CHECKING_CART)

packee_main -> packee_arm: [ROS2 Service] 자세 변경 명령\n(/packee/arm/move_to_pose, pose_type=cart_view)
activate packee_arm

packee_arm -> packee_arm: 장바구니 확인 자세\n(cart_view)

packee_arm --> packee_main: [ROS2 Service] 자세 변경 응답\n(/packee/arm/move_to_pose, pose_type=cart_view)

packee_arm -> packee_main: [ROS2 Topic] 자세 변경 상태\n(/packee/arm/pose_status, status=completed)
deactivate packee_arm

loop 장바구니 유무 확인
    packee_main -> packee_vision: [ROS2 Service] 장바구니 유무 확인 요청\n(/packee/vision/check_cart_presence)
    activate packee_vision

    packee_vision -> packee_vision: 장바구니 유무 확인

    packee_vision --> packee_main: [ROS2 Service] 장바구니 유무 확인 응답\n(/packee/vision/check_cart_presence)
    deactivate packee_vision
end

packee_main -> packee_main: Packee 상태 변경\n(CHECKING_CART->DETECTING_PRODUCTS)

packee_main -> main: [ROS2 Topic] 작업 가능 확인 완료\n(/packee/availability_result)

deactivate packee_main
deactivate main

@enduml