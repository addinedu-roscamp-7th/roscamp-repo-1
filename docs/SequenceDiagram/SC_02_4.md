@startuml SC_02_4
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Shopee App" as app
participant "Shopee\nMain Service" as main
participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as vision
participant "Pickee\nArm Controller" as pickee_arm

app -> main: [TCP] 상품 선택 요청\n(product_selection)
activate main

main --> app: [TCP] 상품 선택 응답\n(product_selection_response)

main -> pickee_main: [ROS2 Service] 상품 담기 명령\n(/pickee/product/process_selection)
activate pickee_main

pickee_main --> main: [ROS2 Service] 상품 담기 명령 응답\n(/pickee/product/process_selection)

pickee_main -> pickee_main: Pickee 상태 변경\n(DETECTING_PRODUCT/WAITING_SELECTION->PICKING_PRODUCT)

pickee_main -> pickee_arm: [ROS2 Service] 상품 픽업 요청\n(/pickee/arm/pick_product)
activate pickee_arm

pickee_arm --> pickee_main: [ROS2 Service] 상품 픽업 응답\n(/pickee/arm/pick_product)

pickee_arm -> pickee_arm: Grasp Planning\n(그리퍼 경로 계획)
activate pickee_arm #DarkSalmon
deactivate pickee_arm

pickee_arm -> pickee_arm: Motion Execution\n(집기 동작)
activate pickee_arm #DarkSalmon
deactivate pickee_arm

pickee_arm -> pickee_main: [ROS2 Topic] 픽업 상태\n(/pickee/arm/pick_status)

pickee_main -> pickee_arm: [ROS2 Service] 상품 담기 요청\n(/pickee/arm/place_product)

pickee_arm --> pickee_main: [ROS2 Service] 상품 담기 응답\n(/pickee/arm/place_product)

pickee_arm -> pickee_arm: Motion Execution\n(장바구니 담기)
activate pickee_arm #DarkSalmon
deactivate pickee_arm

pickee_arm -> pickee_main: [ROS2 Topic] 담기 상태\n(/pickee/arm/place_status)

pickee_main -> pickee_arm: [ROS2 Service] 자세 변경 요청\n(/pickee/arm/move_to_pose)

pickee_arm --> pickee_main: [ROS2 Service] 자세 변경 요청\n(/pickee/arm/move_to_pose)

pickee_arm -> pickee_arm: 장바구니 확인 자세\n실행
activate pickee_arm #DarkSalmon
deactivate pickee_arm

pickee_arm -> pickee_main: [ROS2 Topic] 자세 변경 상태\n(/pickee/arm/pose_status)

pickee_main -> vision: [ROS2 Service] 장바구니 내 특정 상품 확인 요청\n(/pickee/vision/check_product_in_cart)
activate vision

vision -> vision: 해당 상품\n장바구니 확인
activate vision #DarkSalmon
deactivate vision

vision --> pickee_main: [ROS2 Service] 장바구니 내 특정 상품 확인 요청\n(/pickee/vision/check_product_in_cart)
deactivate vision

pickee_main -> main: [ROS2 Topic] 상품 담기 결과\n(/pickee/product/selection_result)

main -> app: [TCP] 장바구니 담기 알림\n(cart_update_notification)

pickee_main -> pickee_arm: [ROS2 Service] 자세 변경 요청\n(/pickee/arm/move_to_pose)
activate pickee_arm

pickee_arm --> pickee_main: [ROS2 Service] 자세 변경 응답\n(/pickee/arm/move_to_pose)

pickee_arm -> pickee_arm: 대기 자세\n실행
activate pickee_arm #DarkSalmon
deactivate pickee_arm

pickee_arm -> pickee_main: [ROS2 Topic] 자세 변경 상태\n(/pickee/arm/pose_status)
deactivate pickee_arm
deactivate pickee_main
deactivate main

@enduml