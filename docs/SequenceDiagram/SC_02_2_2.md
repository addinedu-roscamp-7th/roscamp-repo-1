@startuml SC_02_2_2
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as vision
participant "Pickee\nMobile Controller" as pickee_mobile

loop 장애물 거리 모니터링
    vision -> vision: 장애물 인식
    activate vision
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> vision: 장애물 분류\n(타입, 위치, 속도, 거리)
    activate vision #DarkSalmon
    deactivate vision
    
    vision -> pickee_main: [ROS2 Topic] 장애물 감지 알림\n(/pickee/vision/obstacle_detected)
    activate pickee_main
    
    pickee_main -> pickee_main: 충돌 위험 계산
    activate pickee_main #DarkSalmon
    deactivate pickee_main
    
    alt 거리 < 2m
        pickee_main -> pickee_mobile: [ROS2 Topic] /pickee/mobile/speed_control\n(speed_mode: "decelerate")
        activate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 감속 주행
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        deactivate pickee_mobile
        
    else 거리 < 1m
        pickee_main -> pickee_mobile: [ROS2 Topic] /pickee/mobile/speed_control\n(speed_mode: "stop")
        activate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 정지
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        deactivate pickee_mobile
        
    else 안전거리 확보
        pickee_main -> pickee_mobile: [ROS2 Topic] /pickee/mobile/speed_control\n(speed_mode: "normal")
        activate pickee_mobile
        
        pickee_mobile -> pickee_mobile: 정상 주행
        activate pickee_mobile #DarkSalmon
        deactivate pickee_mobile
        
        deactivate pickee_mobile
    end
    
    deactivate pickee_main
    deactivate vision
end

@enduml