@startuml SC_06_3
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

actor "직원" as user
participant "Shopee\nMain Service" as main
participant "DB Manager" as db
participant "LLM Service" as llm
participant "Pickee\nMain Controller" as pickee_main
participant "Pickee\nVision AI Service" as vision

user -> pickee_main: 음성 "피키야, B상품 A창고에 가져다줘"
activate pickee_main

pickee_main -> pickee_main: STT\n(음성->텍스트)
activate pickee_main #DarkSalmon
deactivate pickee_main

pickee_main -> llm: [HTTP] 텍스트 명령 전달\n(GET /llm/intent_detection)
activate llm

llm -> llm: 발화 의도 분석
activate llm #DarkSalmon
deactivate llm

llm --> pickee_main: [HTTP] 분석 결과\n(intent: "Move_place", ...)
deactivate llm

pickee_main -> vision: [ROS2 Service] 직원 추종 중지\n(/pickee/vision/track_staff)
activate vision

vision -> vision: 추종 중지
activate vision #DarkSalmon
deactivate vision

vision --> pickee_main: [ROS2 Service] 추종 중지 완료
deactivate vision

pickee_main -> pickee_main: 현재 좌표(직원 위치) 저장
activate pickee_main #DarkSalmon
deactivate pickee_main

' This section is updated based on the new XML
pickee_main -> main: [ROS2 Service] 창고 좌표 조회\n(/main/get_warehouse_pose)
activate main

main -> db: 창고 좌표 조회
activate db

db --> main: 창고 좌표 응답
deactivate db

main --> pickee_main: [ROS2 Service] 창고 좌표 조회 응답\n(/main/get_warehouse_pose)
deactivate main

pickee_main -> pickee_main: 음성 송출\n("목적지로 이동합니다.")
activate pickee_main #DarkSalmon
deactivate pickee_main

pickee_main -> pickee_main: Pickee 상태 변경\n(FOLLOWING_STAFF->MOVING_TO_DESTINATION)
activate pickee_main #DarkSalmon
deactivate pickee_main

deactivate pickee_main

@enduml
