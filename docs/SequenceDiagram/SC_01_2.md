@startuml SC_01_2
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

actor User as user
participant "Shopee App" as app
participant "Shopee\nMain Service" as main
participant "Shopee\nLLM Service" as llm
participant "DB Manager" as db

user -> app: 상품 검색을 위한 음성/텍스트 입력
activate app

alt 음성 입력
    app -> app: 음성 인식\n(STT)
    activate app #DarkSalmon
    deactivate app
    
    app -> main: [TCP] 인식된 텍스트 전달\n(product_search)
    activate main
else 텍스트 입력
    app -> main: [TCP] 검색어 전달\n(product_search)
end

main -> llm: [HTTP] 상품 검색 쿼리 생성\n(search_request)
activate llm

llm -> llm: 검색 조건 추출
activate llm #DarkSalmon
deactivate llm

llm --> main: [HTTP] 상품 검색 쿼리 생성 응답\n(search_answer)
deactivate llm

main -> db: 상품 테이블 조회
activate db

db -> db: 검색 쿼리 실행
activate db #DarkSalmon
deactivate db

db --> main: 상품 리스트\n(id, name, price, quantity, section_id, category, allergy_info_id, is_vegan)
deactivate db

main --> app: [TCP] 검색 결과 전달\n(product_search_response)
deactivate main

app -> app: 상품 목록\n표시
activate app #DarkSalmon
deactivate app

deactivate app

@enduml