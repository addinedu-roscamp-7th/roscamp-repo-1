@startuml
title 관리자 모니터링 - 로봇 시야 확인
participant "Shopee App" as app
participant "Shopee\nMain Service" as shopee
participant "Pickee\nMain Controller" as pickee
participant "Pickee\nVision AI Service" as vision

app -> shopee: [TCP] 영상 송출 시작 요청\n(video_stream_start)
activate shopee

shopee -> pickee: [ROS2] 영상 송출 시작 요청\n(/pickee/video_stream/start)
activate pickee

pickee -> vision: [ROS2] 영상 송출 시작 요청\n(/pickee/vision/video_stream_start)
activate vision

vision --> pickee: [ROS2] 영상 송출 시작 응답\n(/pickee/vision/video_stream_start)
deactivate vision

pickee --> shopee: [ROS2] 영상 송출 시작 응답\n(/pickee/video_stream/start)
deactivate pickee

shopee --> app: [TCP] 영상 송출 시작 응답\n(video_stream_start)
deactivate shopee

loop
    vision -> shopee: [UDP] 영상 송출\n(video_frame, robot_id 포함)
    activate shopee

    shopee -> shopee: 세션 기반 중계\n(robot_id로 시청자 식별)

    shopee -> app: [UDP] 영상 송출\n(video_frame, robot_id 포함)
    activate app

    app -> app: 영상\n화면 표시
    deactivate app
    deactivate shopee
end

note right of shopee
  Main Service는 robot_id로
  복수 로봇-복수 사용자
  세션을 동시에 관리
end note

@enduml