@startuml SC_03_1
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceMessageAlign center

participant "Shopee\nMain Service" as Main
participant "DB Manager" as DB
participant "Pickee\nMain Controller" as Controller
participant "Pickee\nMobile Controller" as Mobile

Main -> Controller: [ROS2 Service] 포장대 이동 명령\n(/pickee/workflow/move_to_packaging)
activate Controller
Controller --> Main: [ROS2 Service] 포장대 이동 명령 응답\n(/pickee/workflow/move_to_packaging)

Controller -> Main: [ROS2 Service] 목적지 좌표 요청\n(/main/get_location_pose)
activate Main
Main -> DB: 포장대 좌표 요청
activate DB
DB --> Main: 포장대 좌표 반환
deactivate DB
Main --> Controller: [ROS2 Service] 목적지 좌표 응답\n(/main/get_location_pose)
deactivate Main

Controller -> Controller: Global Path\n계획
activate Controller #DarkSalmon
deactivate Controller

Controller -> Mobile: [ROS2 Service] 목적지 이동 명령\n(/pickee/mobile/move_to_location)
activate Mobile
Mobile --> Controller: [ROS2 Service] 목적지 이동 명령 응답\n(/pickee/mobile/move_to_location)

Mobile -> Mobile: 경로 주행
activate Mobile #DarkSalmon
deactivate Mobile

Mobile -> Controller: [ROS2 Topic] 도착 알림\n(/pickee/mobile/arrival)
deactivate Mobile

Controller -> Main: [ROS2 Topic] 도착 보고\n(/pickee/arrival_notice)

Controller -> Controller: 장바구니 교체\n직원 안내음 송출
activate Controller #DarkSalmon
deactivate Controller

Controller -> Controller: Pickee 상태 전환\n(MOVING_TO_PACKING -> WAITING_HANDOVER)
activate Controller #DarkSalmon
deactivate Controller

deactivate Controller
@enduml