# Pickee Arm 개발 계획

## 1. 개요

`pickee_arm` 패키지는 Pickee 로봇의 팔(Arm) 제어를 담당하는 ROS2 패키지이다.

이 패키지의 개발은 2단계로 진행된다.
- **1단계 (수동 지정 좌표 기반 제어)**: 빠른 프로토타이핑과 시스템 초기 통합을 위해, 미리 정의된 고정된 위치(관절 각도)로 팔을 움직이는 방식으로 구현한다. `pickee_arm`은 `pickee_main`으로부터 목표 자세를 지시받아 실행하는 단순 실행기(Actuator) 역할을 수행한다.
- **2단계 (Deep Learning 기반 제어)**: 오프라인에서 학습된 딥러닝 모델을 **활용**하여, 이미지로부터 직접 로봇 팔의 관절 각도를 예측하고 제어하는 End-to-End 시스템을 구축하는 것을 목표로 한다.

## 2. 개발 목표

### 2.1. 1단계 목표 (수동 지정 좌표)
- 수동으로 지정된 관절 각도 값을 기반으로 안정적인 피킹 및 플레이스 동작 구현
- `pickee_main`과의 서비스/토픽 통신을 안정적으로 수행

### 2.2. 2단계 목표 (Deep Learning)
- 오프라인 환경에서 로봇 팔의 이미지-관절각도 데이터셋 구축 및 `PoseCNN` 모델 학습
- `pickee_arm` 패키지 내에서, 학습된 `PoseCNN` 모델을 로드하여 실시간 추론 및 제어 기능 구현

## 3. 주요 기능

- **서비스 서버**: `pickee_main`으로부터 '자세 변경', '상품 피킹', '상품 놓기' 등의 작업을 Service 요청으로 수신한다.
- **상태 퍼블리셔**: 작업 수행 중 현재 상태를 토픽으로 발행하여 `pickee_main`에 보고한다.
- **모션 시퀀서 (1단계)**: 서비스 요청에 따라, 미리 정의된 관절 각도 시퀀스를 순차적으로 실행한다.
- **추론 기반 제어기 (2단계)**: `pickee_arm` 노드가 실시간 이미지 입력을 받아, 학습된 모델을 통해 목표 관절 각도를 추론하고 실행한다.

## 4. 개발 및 테스트 환경

- **언어**: Python
- **ROS 버전**: ROS2 Jazzy
- **주요 라이브러리**:
  - `rclpy`, `shopee_interfaces`: ROS2 통신
  - `torch`, `torchvision`, `pandas`, `ultralytics`, `opencv-python`: (주로 오프라인 학습 및 2단계 추론 기능에 사용)

## 5. ROS2 인터페이스

- `pickee_main`과의 통신 인터페이스는 최신 명세 문서를 그대로 따른다. (서비스 3개, 토픽 3개)

## 6. 개발 계획 (Milestones)

### Phase 1: Manual Coordinate-Based Control
| Milestone | 주요 개발 내용                                         |
| :-------- | :----------------------------------------------------- |
| M1.1      | **기본 컨트롤러 및 포즈 정의**: 단일 컨트롤러 노드 생성 및 주요 동작에 대한 관절 각도 값을 상수로 정의 |
| M1.2      | **순차 동작 로직 구현**: 서비스 요청 시, 정의된 포즈들을 순서대로 실행하는 로직 구현 |
| M1.3      | **통합 및 테스트**: `pickee_main`과의 연동 및 실제 로봇 환경에서 시나리오 검증 |

### Phase 2: Deep Learning-Based Control Implementation (Future Work)
| Milestone | 주요 개발 내용                                         |
| :-------- | :----------------------------------------------------- |
| M2.1      | **[오프라인] 데이터 수집 및 모델 학습**: 제공된 코드를 활용하여 이미지-관절각도 데이터셋을 구축하고 `PoseCNN` 모델을 학습. (`best.pt` 파일 생성) |
| M2.2      | **[패키지 내] 추론 로직 구현**: `pickee_arm` 노드에 학습된 모델(`best.pt`)을 로드하고, 실시간 이미지로부터 관절 각도를 추론하는 기능 구현 |
| M2.3      | **[패키지 내] 제어 로직 교체**: 1단계의 로직을 2단계의 추론 기반 제어 로직으로 교체 |

## 7. 테스트 계획

### 7.1. 1단계 테스트 (수동 지정 좌표 기반)
- **통합 테스트**: `pickee_main`의 서비스 요청에 따라, `pickee_arm`이 정확한 순서의 동작을 수행하고 올바른 상태 토픽을 발행하는지 검증한다.
- **시나리오 테스트**: 실제 로봇 환경에서 전체 피킹-플레이스 시나리오를 반복 테스트하여 안정성을 검증한다.

### 7.2. 2단계 테스트 (Deep Learning)
- **모델 평가 [오프라인]**: 테스트 데이터셋에 대한 모델의 예측 정확도를 측정한다.
- **E2E 테스트 [온라인]**: 실제 환경에서, `pickee_arm` 노드가 카메라로 상품을 보고 피킹 및 플레이스하는 전체 과정의 성공률을 측정한다.
